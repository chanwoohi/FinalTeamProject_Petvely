<!DOCTYPE html>
<html 
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
	layout:decorate="~{layout/layout.html}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<main layout:fragment="content">
		<div th:if="${post != null}" th:object="${post}">
			<br/>
			<div class="from-group">
				<label>ì œëª© : </label>
				<input type="text" class="form-control" readonly th:field="*{po_title}">
			</div>
			<div class="from-group">
				<label>ì‘ì„±ì : </label>
				<input type="text" class="form-control" readonly th:field="*{po_me_num}">
			</div>
			<div class="form-group">
		    <label>ì‘ì„±ì¼:</label>
		    <input type="text" class="form-control" readonly
		           name="po_date"
		           th:value="*{po_date}"> <!-- ë°ì´í„° í¬ë§· ë³€ê²½ ì—†ì´ ì‚¬ìš© -->
			</div>
			<div class="from-group">
				<label>ì¡°íšŒìˆ˜ : </label>
				<input type="text" class="form-control" readonly th:field="*{po_viewCount}">
			</div>
			<div class="text-center">
			<br/>
		    <a href="#" data-state="1"
		       class="btn-up btn btn" 
		       th:classappend="${re_state != 1} ? '-outline-danger' : '-danger'">
		        ğŸ‘ì¶”ì²œ(<span th:text="${post.po_up}"></span>)
		    </a>
		    <a href="#" data-state="-1"
		       class="btn-down btn btn" 
		       th:classappend="${re_state != -1} ? '-outline-danger' : '-danger'">
		        ğŸ‘ë¹„ì¶”ì²œ(<span th:text="${post.po_down}"></span>)
		    </a>
			</div>
			<div class="form-group">
				<label>ë‚´ìš©:</label>
				<div class="form-control" style="min-height: 400px; height: auto;"
					th:utext="*{po_content}">
				</div>
			</div>
			<!--  <div class="form-group" th:if="${list != null and #lists.size(list) > 0}">-->
			<div class="form-group">
			     <label>ì²¨ë¶€íŒŒì¼ :</label>
			    <div th:each="file : ${list}">
			        <a th:href="@{'/download/' + ${file.fi_name}}" 
			           class="form-control" 
			           th:download="${file.fi_ori_name}" 
			           th:text="${file.fi_ori_name}">
			        </a>
			    </div>
			</div>
			<a class="btn btn-outline-info" th:href="@{/post/list/0}">ëª©ë¡ìœ¼ë¡œ</a>
			<a class="btn btn-outline-info" th:href="@{/post/update/{po_num}(po_num=*{po_num})}">ìˆ˜ì •</a>
			<a class="btn btn-outline-info" th:href="@{/post/delete/{po_num}(po_num=*{po_num})}">ì‚­ì œ</a>
		</div>
		
		<script type="text/javascript">

		let prevState = 0; // ì´ˆê¸° ìƒíƒœ (0: ì•„ë¬´ ìƒíƒœ ì•„ë‹˜)
		//ì¶”ì²œ/ë¹„ì¶”ì²œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		$('.btn-up, .btn-down').click(function(e) {
		    e.preventDefault();
		
		    let state = $(this).data('state');  // ì¶”ì²œ: 1, ë¹„ì¶”ì²œ: -1
		    let num = [[${post.po_num}]];       // ê²Œì‹œê¸€ ë²ˆí˜¸
		   
		   

		    $.ajax({
		        url: '/post/recommend',
		        method: 'get',
		        data: {
		            state: state,
		            num: num
		        },
		        
		    	success : function(data){
					let res = data.result;
					console.log(res);
					// ìƒíƒœì— ë”°ë¼ ì•Œë¦¼ ë©”ì‹œì§€ ì¶œë ¥
	                // ë©”ì‹œì§€ ì¶œë ¥ ë° ìƒíƒœ ê´€ë¦¬
	                if (res === 1) {
	                    if (prevState === -1) {
	                        alert('ë¹„ì¶”ì²œì„ ì·¨ì†Œí•˜ê³  ì¶”ì²œí–ˆìŠµë‹ˆë‹¤.'); // ë¹„ì¶”ì²œ ì·¨ì†Œ í›„ ì¶”ì²œ
	                    } else {
	                        alert('ì¶”ì²œ í–ˆìŠµë‹ˆë‹¤.'); // ì¶”ì²œ
	                    }
	                } else if (res === -1) {
	                    if (prevState === 1) {
	                        alert('ì¶”ì²œì„ ì·¨ì†Œí•˜ê³  ë¹„ì¶”ì²œí–ˆìŠµë‹ˆë‹¤.'); // ì¶”ì²œ ì·¨ì†Œ í›„ ë¹„ì¶”ì²œ
	                    } else {
	                        alert('ë¹„ì¶”ì²œ í–ˆìŠµë‹ˆë‹¤.'); // ë¹„ì¶”ì²œ
	                    }
	                } else if (res === 0) {
	                    if (prevState === 1) {
	                        alert('ì¶”ì²œì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.'); // ì¶”ì²œ ì·¨ì†Œ
	                    } else if (prevState === -1) {
	                        alert('ë¹„ì¶”ì²œì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.'); // ë¹„ì¶”ì²œ ì·¨ì†Œ
	                    }
	                }
					
					checkRecommendBtns(res);

					 prevState = res; // í˜„ì¬ ìƒíƒœ ì—…ë°ì´íŠ¸

					console.log(data);
	                
					let post = JSON.parse(data.post);
					console.log(post);
					$('.btn-up span').text(post.po_up);
					$('.btn-down span').text(post.po_down);
				}, 
		        error: function(xhr, status, error) {
		            console.log('ì¶”ì²œ/ë¹„ì¶”ì²œ ìš”ì²­ ì¤‘ ì—ëŸ¬ ë°œìƒ', error);
		        }
		    });
		});
		//í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì¶”ì²œ/ë¹„ì¶”ì²œì— ë”°ë¼ ê° ë²„íŠ¼ì˜ ìƒ‰ìƒì„ ì±„ì›Œì£¼ëŠ” í•¨ìˆ˜
		function checkRecommendBtns(state){
			$('.btn-up, .btn-down').removeClass('btn-danger');
			$('.btn-up, .btn-down').addClass('btn-outline-danger');
			if(state != 0){
				$(state==1?'.btn-up':'.btn-down').removeClass('btn-outline-danger');
				$(state==1?'.btn-up':'.btn-down').addClass('btn-danger');
			}

		}

		</script>
		
		
	</main>
</body>
</html>