<!DOCTYPE html>
<html 
xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
layout:decorate="~{layout/layout.html}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<main layout:fragment="content">
		<form method="post" th:action="@{/gatpost/insert}">
			<input type="hidden" name="po_num" th:value="${po_num}"/>
			<div class="form-group">
				<label>제목:</label>
				<input type="text" class="form-control" name="po_title" >
			</div>
			<div class="form-group">
				<label>작성자:</label>
				<input type="text" class="form-control" name="po_me_id" >
			</div>
			<div class="form-group">
				<label>내용:</label>
				<textarea class="form-control" style="min-height: 400px; height: auto;" name="po_content" >
				</textarea>
			</div>
			<div class="form-group">
				<label>타입:</label>
				<input type="text" class="form-control" name="gat_gatt_type" >
			</div>
			<div class="form-group">
				<label>시작날짜:</label>
				<input type="date" class="form-control" name="gat_startDate" >
			</div>
			<div class="form-group">
				<label>종료날짜:</label>
				<input type="date" class="form-control" name="gat_endDate" >
			</div>
			<div class="form-group">
				<label>품앗이:</label>
				<input type="text" class="form-control" name="gat_gat" >
			</div>
			<div class="form-group">
				<label>상태:</label>
				<input type="text" class="form-control" name="gat_gats_state" >
			</div>
			<div class="form-group" id="address">
				<label>주소:</label>
				<select id="sido">
					<option th:each="itemSido : ${sidoList}" th:text="${itemSido.sido_name}" th:value="${itemSido.sido_num}"></option>
				</select>
				<select id="sigg">
				</select>
				<select id="emd" name="emd_num">
				</select>
			</div>
			<button class="btn btn-outline-info col-12">등록</button>
		</form>
		<a class="btn btn-outline-info" th:href="@{/gatpost/list}">목록으로</a>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<script type="text/javascript">
		
		//첫번째 시도번호를 가져옴 
		let firstSido = '[[${sidoList.get(0).sido_num}]]';
		//시도가 변경되면 ajax로 시도에 맞는 시군구를 가져옴
		$('#sido').change(function(){
			let sido_num = $(this).val();
			$.ajax({
				async : true,
				url : '/get/sigg', 
				type : 'post', 
				data : {sido_num}, 
				success : function (data){
					var str = ''
					for(sigg of data){
						str += `
								<option value="${sigg.sigg_num}">${sigg.sigg_name}</option>
						`;
					}
					$('#sigg').html(str);
					$('#sigg').trigger('change');
				},
				error : function(jqXHR, textStatus, errorThrown){
				}
			});
		})
		//select 태그의 값을 변경 후 이벤트 실행
		$('#sido').val(firstSido);
		$('#sido').trigger('change');
		
		$('#sigg').change(function(){
			let sigg_num = $(this).val();
			$.ajax({
				async : true,
				url : '/get/emd', 
				type : 'post', 
				data : {sigg_num}, 
				success : function (data){
					var str = ''
					for(emd of data){
						str += `
								<option value="${emd.emd_num}">${emd.emd_name}</option>
						`;
					}
					$('#emd').html(str);
				},
				error : function(jqXHR, textStatus, errorThrown){
				}
			});
		})
		
		</script>
	</main>
</body>
</html>